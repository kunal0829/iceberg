<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A table format for large, slow-moving tabular data">
    
    <link rel="canonical" href="https://iceberg.apache.org/hive/">
    <link rel="shortcut icon" href="../img/favicon.ico">

    
    <title>Hive - Apache Iceberg</title>
    

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/v4-shims.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3.3.0/build/web/hack.min.css">
    <link href='//rsms.me/inter/inter.css' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="../css/base.min.css" rel="stylesheet">
    <link href="../css/cinder.min.css" rel="stylesheet">

    
        
        <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/styles/github.min.css">
        
    
    <link href="../css/extra.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
        <![endif]-->

    

     
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            
              <a class="navbar-brand" href="..">Apache Iceberg</a>
            
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="..">About</a>
</li>

                        
                            
<li >
    <a href="../community/">Community</a>
</li>

                        
                            
<li >
    <a href="../releases/">Releases</a>
</li>

                        
                            
<li >
    <a href="../blogs/">Blogs</a>
</li>

                        
                            
<li >
    <a href="../trademarks/">Trademarks</a>
</li>

                        
                            
<li >
    <a href="../how-to-release/">How to Release</a>
</li>

                        
                            
<li >
    <a href="../security/">Security</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="../getting-started/">Getting Started</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tables <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../configuration/">Configuration</a>
</li>

                        
                            
<li >
    <a href="../schemas/">Schemas</a>
</li>

                        
                            
<li >
    <a href="../partitioning/">Partitioning</a>
</li>

                        
                            
<li >
    <a href="../evolution/">Table evolution</a>
</li>

                        
                            
<li >
    <a href="../maintenance/">Maintenance</a>
</li>

                        
                            
<li >
    <a href="../performance/">Performance</a>
</li>

                        
                            
<li >
    <a href="../reliability/">Reliability</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Engines <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Spark</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../getting-started/">Getting Started</a>
</li>

        
            
<li >
    <a href="../spark-configuration/">Configuration</a>
</li>

        
            
<li >
    <a href="../spark-ddl/">DDL</a>
</li>

        
            
<li >
    <a href="../spark-queries/">Queries</a>
</li>

        
            
<li >
    <a href="../spark-writes/">Writes</a>
</li>

        
            
<li >
    <a href="../spark-procedures/">Maintenance Procedures</a>
</li>

        
            
<li >
    <a href="../spark-structured-streaming/">Structured Streaming</a>
</li>

        
            
<li >
    <a href="../spark-queries/#time-travel">Time Travel</a>
</li>

        
    </ul>
  </li>

                        
                            
<li >
    <a href="../flink/">Flink</a>
</li>

                        
                            
<li class="active">
    <a href="./">Hive</a>
</li>

                        
                            
<li >
    <a href="https://trino.io/docs/current/connector/iceberg.html">Trino</a>
</li>

                        
                            
<li >
    <a href="https://prestodb.io/docs/current/connector/iceberg.html">PrestoDB</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Integrations <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../aws/">AWS</a>
</li>

                        
                            
<li >
    <a href="../nessie/">Nessie</a>
</li>

                        
                            
<li >
    <a href="../jdbc/">JDBC</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="/javadoc/">Javadoc</a>
</li>

                        
                            
<li >
    <a href="../api/">Java API intro</a>
</li>

                        
                            
<li >
    <a href="../java-api-quickstart/">Java Quickstart</a>
</li>

                        
                            
<li >
    <a href="../custom-catalog/">Java Custom Catalog</a>
</li>

                        
                            
<li >
    <a href="../python-quickstart/">Python Quickstart</a>
</li>

                        
                            
<li >
    <a href="../python-api-intro/">Python API Intro</a>
</li>

                        
                            
<li >
    <a href="../python-feature-support/">Python Feature Support</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Format <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../terms/">Definitions</a>
</li>

                        
                            
<li >
    <a href="../spec/">Spec</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li >
                        <a href="https://github.com/apache/iceberg">GitHub</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">ASF <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="https://www.apache.org/licenses/">License</a>
</li>

                        
                            
<li >
    <a href="https://www.apache.org/security/">Security</a>
</li>

                        
                            
<li >
    <a href="https://www.apache.org/foundation/thanks.html">Sponsors</a>
</li>

                        
                            
<li >
    <a href="https://www.apache.org/foundation/sponsorship.html">Donate</a>
</li>

                        
                            
<li >
    <a href="https://www.apache.org/events/current-event.html">Events</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li >
                        <a rel="prev" href="../flink/">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../aws/">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#hive">Hive</a></li>
            <li class="second-level"><a href="#enabling-iceberg-support-in-hive">Enabling Iceberg support in Hive</a></li>
                
                <li class="third-level"><a href="#loading-runtime-jar">Loading runtime jar</a></li>
                <li class="third-level"><a href="#enabling-support">Enabling support</a></li>
            <li class="second-level"><a href="#catalog-management">Catalog Management</a></li>
                
                <li class="third-level"><a href="#global-hive-catalog">Global Hive catalog</a></li>
                <li class="third-level"><a href="#custom-iceberg-catalogs">Custom Iceberg catalogs</a></li>
            <li class="second-level"><a href="#ddl-commands">DDL Commands</a></li>
                
                <li class="third-level"><a href="#create-external-table">CREATE EXTERNAL TABLE</a></li>
                <li class="third-level"><a href="#create-table">CREATE TABLE</a></li>
                <li class="third-level"><a href="#drop-table">DROP TABLE</a></li>
            <li class="second-level"><a href="#querying-with-sql">Querying with SQL</a></li>
                
                <li class="third-level"><a href="#configurations">Configurations</a></li>
                <li class="third-level"><a href="#select">SELECT</a></li>
            <li class="second-level"><a href="#writing-with-sql">Writing with SQL</a></li>
                
                <li class="third-level"><a href="#configurations_1">Configurations</a></li>
                <li class="third-level"><a href="#insert-into">INSERT INTO</a></li>
            <li class="second-level"><a href="#type-compatibility">Type compatibility</a></li>
                
                <li class="third-level"><a href="#hive-type-to-iceberg-type">Hive type to Iceberg type</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<!--
 - Licensed to the Apache Software Foundation (ASF) under one or more
 - contributor license agreements.  See the NOTICE file distributed with
 - this work for additional information regarding copyright ownership.
 - The ASF licenses this file to You under the Apache License, Version 2.0
 - (the "License"); you may not use this file except in compliance with
 - the License.  You may obtain a copy of the License at
 -
 -   http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS,
 - WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 - See the License for the specific language governing permissions and
 - limitations under the License.
 -->

<h1 id="hive">Hive<a class="headerlink" href="#hive" title="Permanent link">&para;</a></h1>
<p>Iceberg supports reading and writing Iceberg tables through <a href="https://hive.apache.org">Hive</a> by using a <a href="https://cwiki.apache.org/confluence/display/Hive/StorageHandlers">StorageHandler</a>.
Here is the current compatibility matrix for Iceberg Hive support: </p>
<table>
<thead>
<tr>
<th>Feature</th>
<th>Hive 2.x</th>
<th>Hive 3.1.2</th>
</tr>
</thead>
<tbody>
<tr>
<td>CREATE EXTERNAL TABLE</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>CREATE TABLE</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>DROP TABLE</td>
<td>✔️</td>
<td>✔️</td>
</tr>
<tr>
<td>SELECT</td>
<td>✔️ (MapReduce and Tez)</td>
<td>✔️ (MapReduce and Tez)</td>
</tr>
<tr>
<td>INSERT INTO</td>
<td>✔️ (MapReduce only)️</td>
<td>✔️ (MapReduce only)</td>
</tr>
</tbody>
</table>
<h2 id="enabling-iceberg-support-in-hive">Enabling Iceberg support in Hive<a class="headerlink" href="#enabling-iceberg-support-in-hive" title="Permanent link">&para;</a></h2>
<h3 id="loading-runtime-jar">Loading runtime jar<a class="headerlink" href="#loading-runtime-jar" title="Permanent link">&para;</a></h3>
<p>To enable Iceberg support in Hive, the <code>HiveIcebergStorageHandler</code> and supporting classes need to be made available on Hive&rsquo;s classpath. 
These are provided by the <code>iceberg-hive-runtime</code> jar file. 
For example, if using the Hive shell, this can be achieved by issuing a statement like so:</p>
<pre><code>add jar /path/to/iceberg-hive-runtime.jar;
</code></pre>
<p>There are many others ways to achieve this including adding the jar file to Hive&rsquo;s auxiliary classpath so it is available by default.
Please refer to Hive&rsquo;s documentation for more information.</p>
<h3 id="enabling-support">Enabling support<a class="headerlink" href="#enabling-support" title="Permanent link">&para;</a></h3>
<p>If the Iceberg storage handler is not in Hive&rsquo;s classpath, then Hive cannot load or update the metadata for an Iceberg table when the storage handler is set.
To avoid the appearance of broken tables in Hive, Iceberg will not add the storage handler to a table unless Hive support is enabled.
The storage handler is kept in sync (added or removed) every time Hive engine support for the table is updated, i.e. turned on or off in the table properties.
There are two ways to enable Hive support: globally in Hadoop Configuration and per-table using a table property.</p>
<h4 id="hadoop-configuration">Hadoop configuration<a class="headerlink" href="#hadoop-configuration" title="Permanent link">&para;</a></h4>
<p>To enable Hive support globally for an application, set <code>iceberg.engine.hive.enabled=true</code> in its Hadoop configuration. 
For example, setting this in the <code>hive-site.xml</code> loaded by Spark will enable the storage handler for all tables created by Spark.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When using Hive with Tez in <code>0.11.x</code> releases, you also have to disable vectorization (<code>hive.vectorized.execution.enabled=false</code>)</p>
</div>
<h4 id="table-property-configuration">Table property configuration<a class="headerlink" href="#table-property-configuration" title="Permanent link">&para;</a></h4>
<p>Alternatively, the property <code>engine.hive.enabled</code> can be set to <code>true</code> and added to the table properties when creating the Iceberg table. 
Here is an example of doing it programmatically:</p>
<pre><code class="language-java">Catalog catalog = ...;
Map&lt;String, String&gt; tableProperties = Maps.newHashMap();
tableProperties.put(TableProperties.ENGINE_HIVE_ENABLED, &quot;true&quot;); // engine.hive.enabled=true
catalog.createTable(tableId, schema, spec, tableProperties);
</code></pre>
<p>The table level configuration overrides the global Hadoop configuration.</p>
<h2 id="catalog-management">Catalog Management<a class="headerlink" href="#catalog-management" title="Permanent link">&para;</a></h2>
<h3 id="global-hive-catalog">Global Hive catalog<a class="headerlink" href="#global-hive-catalog" title="Permanent link">&para;</a></h3>
<p>From the Hive engine&rsquo;s perspective, there is only one global data catalog that is defined in the Hadoop configuration in the runtime environment.
In contrast, Iceberg supports multiple different data catalog types such as Hive, Hadoop, AWS Glue, or custom catalog implementations.
Iceberg also allows loading a table directly based on its path in the file system. Those tables do not belong to any catalog.
Users might want to read these cross-catalog and path-based tables through the Hive engine for use cases like join.</p>
<p>To support this, a table in the Hive metastore can represent three different ways of loading an Iceberg table,
depending on the table&rsquo;s <code>iceberg.catalog</code> property:</p>
<ol>
<li>The table will be loaded using a <code>HiveCatalog</code> that corresponds to the metastore configured in the Hive environment if no <code>iceberg.catalog</code> is set</li>
<li>The table will be loaded using a custom catalog if <code>iceberg.catalog</code> is set to a catalog name (see below)</li>
<li>The table can be loaded directly using the table&rsquo;s root location if <code>iceberg.catalog</code> is set to <code>location_based_table</code></li>
</ol>
<p>For cases 2 and 3 above, users can create an overlay of an Iceberg table in the Hive metastore,
so that different table types can work together in the same Hive environment.
See <a href="#create-external-table">CREATE EXTERNAL TABLE</a> and <a href="#create-table">CREATE TABLE</a> for more details.</p>
<h3 id="custom-iceberg-catalogs">Custom Iceberg catalogs<a class="headerlink" href="#custom-iceberg-catalogs" title="Permanent link">&para;</a></h3>
<p>To globally register different catalogs, set the following Hadoop configurations:</p>
<table>
<thead>
<tr>
<th>Config Key</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>iceberg.catalog.&lt;catalog_name>.type</td>
<td>type of catalog: <code>hive</code> or <code>hadoop</code></td>
</tr>
<tr>
<td>iceberg.catalog.&lt;catalog_name>.catalog-impl</td>
<td>catalog implementation, must not be null if type is null</td>
</tr>
<tr>
<td>iceberg.catalog.&lt;catalog_name>.&lt;key></td>
<td>any config key and value pairs for the catalog</td>
</tr>
</tbody>
</table>
<p>Here are some examples using Hive CLI:</p>
<p>Register a <code>HiveCatalog</code> called <code>another_hive</code>:</p>
<pre><code>SET iceberg.catalog.another_hive.type=hive;
SET iceberg.catalog.another_hive.uri=thrift://example.com:9083;
SET iceberg.catalog.another_hive.clients=10;
SET iceberg.catalog.another_hive.warehouse=hdfs://example.com:8020/warehouse;
</code></pre>
<p>Register a <code>HadoopCatalog</code> called <code>hadoop</code>:</p>
<pre><code>SET iceberg.catalog.hadoop.type=hadoop;
SET iceberg.catalog.hadoop.warehouse=hdfs://example.com:8020/warehouse;
</code></pre>
<p>Register an AWS <code>GlueCatalog</code> called <code>glue</code>:</p>
<pre><code>SET iceberg.catalog.glue.catalog-impl=org.apache.iceberg.aws.GlueCatalog;
SET iceberg.catalog.glue.warehouse=s3://my-bucket/my/key/prefix;
SET iceberg.catalog.glue.lock-impl=org.apache.iceberg.aws.glue.DynamoLockManager;
SET iceberg.catalog.glue.lock.table=myGlueLockTable;
</code></pre>
<h2 id="ddl-commands">DDL Commands<a class="headerlink" href="#ddl-commands" title="Permanent link">&para;</a></h2>
<h3 id="create-external-table">CREATE EXTERNAL TABLE<a class="headerlink" href="#create-external-table" title="Permanent link">&para;</a></h3>
<p>The <code>CREATE EXTERNAL TABLE</code> command is used to overlay a Hive table &ldquo;on top of&rdquo; an existing Iceberg table. 
Iceberg tables are created using either a <a href="../javadoc/master/?org/apache/iceberg/catalog/Catalog.html"><code>Catalog</code></a>,
or an implementation of the <a href="../javadoc/master/?org/apache/iceberg/Tables.html"><code>Tables</code></a> interface,
and Hive needs to be configured accordingly to operate on these different types of table.</p>
<h4 id="hive-catalog-tables">Hive catalog tables<a class="headerlink" href="#hive-catalog-tables" title="Permanent link">&para;</a></h4>
<p>As described before, tables created by the <code>HiveCatalog</code> with Hive engine feature enabled are directly visible by the Hive engine, so there is no need to create an overlay.</p>
<h4 id="custom-catalog-tables">Custom catalog tables<a class="headerlink" href="#custom-catalog-tables" title="Permanent link">&para;</a></h4>
<p>For a table in a registered catalog, specify the catalog name in the statement using table property <code>iceberg.catalog</code>.
For example, the SQL below creates an overlay for a table in a <code>hadoop</code> type catalog named <code>hadoop_cat</code>:</p>
<pre><code class="language-sql">SET iceberg.catalog.hadoop_cat.type=hadoop;
SET iceberg.catalog.hadoop_cat.warehouse=hdfs://example.com:8020/hadoop_cat;

CREATE EXTERNAL TABLE database_a.table_a
STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler'
TBLPROPERTIES ('iceberg.catalog'='hadoop_cat');
</code></pre>
<p>When <code>iceberg.catalog</code> is missing from both table properties and the global Hadoop configuration, <code>HiveCatalog</code> will be used as default.</p>
<h4 id="path-based-hadoop-tables">Path-based Hadoop tables<a class="headerlink" href="#path-based-hadoop-tables" title="Permanent link">&para;</a></h4>
<p>Iceberg tables created using <code>HadoopTables</code> are stored entirely in a directory in a filesystem like HDFS.
These tables are considered to have no catalog. 
To indicate that, set <code>iceberg.catalog</code> property to <code>location_based_table</code>. For example:</p>
<pre><code class="language-sql">CREATE EXTERNAL TABLE table_a 
STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler' 
LOCATION 'hdfs://some_bucket/some_path/table_a'
TBLPROPERTIES ('iceberg.catalog'='location_based_table');
</code></pre>
<h3 id="create-table">CREATE TABLE<a class="headerlink" href="#create-table" title="Permanent link">&para;</a></h3>
<p>Hive also supports directly creating a new Iceberg table through <code>CREATE TABLE</code> statement. For example:</p>
<pre><code class="language-sql">CREATE TABLE database_a.table_a (
  id bigint, name string
) PARTITIONED BY (
  dept string
) STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler';
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>to Hive, the table appears to be unpartitioned although the underlying Iceberg table is partitioned.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to the limitation of Hive <code>PARTITIONED BY</code> syntax, if you use Hive <code>CREATE TABLE</code>, 
currently you can only partition by columns, which is translated to Iceberg identity partition transform.
You cannot partition by other Iceberg partition transforms such as <code>days(timestamp)</code>.
To create table with all partition transforms, you need to create the table with other engines like Spark or Flink.</p>
</div>
<h4 id="custom-catalog-table">Custom catalog table<a class="headerlink" href="#custom-catalog-table" title="Permanent link">&para;</a></h4>
<p>You can also create a new table that is managed by a custom catalog. 
For example, the following code creates a table in a custom Hadoop catalog:</p>
<pre><code class="language-sql">SET iceberg.catalog.hadoop_cat.type=hadoop;
SET iceberg.catalog.hadoop_cat.warehouse=hdfs://example.com:8020/hadoop_cat;

CREATE TABLE database_a.table_a (
  id bigint, name string
) PARTITIONED BY (
  dept string
) STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler'
TBLPROPERTIES ('iceberg.catalog'='hadoop_cat');
</code></pre>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the table to create already exists in the custom catalog, this will create a managed overlay table.
This means technically you can omit the <code>EXTERNAL</code> keyword when creating an overlay table.
However, this is <strong>not recommended</strong> because creating managed overlay tables could pose a risk
to the shared data files in case of accidental drop table commands from the Hive side, 
which would unintentionally remove all the data in the table.</p>
</div>
<h3 id="drop-table">DROP TABLE<a class="headerlink" href="#drop-table" title="Permanent link">&para;</a></h3>
<p>Tables can be dropped using the <code>DROP TABLE</code> command:</p>
<pre><code class="language-sql">DROP TABLE [IF EXISTS] table_name [PURGE];
</code></pre>
<p>You can configure purge behavior through global Hadoop configuration or Hive metastore table properties:</p>
<table>
<thead>
<tr>
<th>Config key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>external.table.purge</td>
<td>true</td>
<td>if all data and metadata should be purged in a table by default</td>
</tr>
</tbody>
</table>
<p>Each Iceberg table&rsquo;s default purge behavior can also be configured through Iceberg table properties:</p>
<table>
<thead>
<tr>
<th>Property</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>gc.enabled</td>
<td>true</td>
<td>if all data and metadata should be purged in the table by default</td>
</tr>
</tbody>
</table>
<p>When changing <code>gc.enabled</code> on the Iceberg table via <code>UpdateProperties</code>, <code>external.table.purge</code> is also updated on HMS table accordingly.
When setting <code>external.table.purge</code> as a table prop during Hive <code>CREATE TABLE</code>, <code>gc.enabled</code> is pushed down accordingly to the Iceberg table properties.
This makes sure that the 2 properties are always consistent at table level between Hive and Iceberg.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Changing <code>external.table.purge</code> via Hive <code>ALTER TABLE SET TBLPROPERTIES</code> does not update <code>gc.enabled</code> on the Iceberg table. 
This is a limitation on Hive 3.1.2 because the <code>HiveMetaHook</code> doesn&rsquo;t have all the hooks for alter tables yet.</p>
</div>
<h2 id="querying-with-sql">Querying with SQL<a class="headerlink" href="#querying-with-sql" title="Permanent link">&para;</a></h2>
<p>Here are the features highlights for Iceberg Hive read support:</p>
<ol>
<li><strong>Predicate pushdown</strong>: Pushdown of the Hive SQL <code>WHERE</code> clause has been implemented so that these filters are used at the Iceberg <code>TableScan</code> level as well as by the Parquet and ORC Readers.</li>
<li><strong>Column projection</strong>: Columns from the Hive SQL <code>SELECT</code> clause are projected down to the Iceberg readers to reduce the number of columns read.</li>
<li><strong>Hive query engines</strong>: Both the MapReduce and Tez query execution engines are supported.</li>
</ol>
<h3 id="configurations">Configurations<a class="headerlink" href="#configurations" title="Permanent link">&para;</a></h3>
<p>Here are the Hadoop configurations that one can adjust for the Hive reader:</p>
<table>
<thead>
<tr>
<th>Config key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>iceberg.mr.reuse.containers</td>
<td>false</td>
<td>if Avro reader should reuse containers</td>
</tr>
<tr>
<td>iceberg.mr.case.sensitive</td>
<td>true</td>
<td>if the query is case-sensitive</td>
</tr>
</tbody>
</table>
<h3 id="select">SELECT<a class="headerlink" href="#select" title="Permanent link">&para;</a></h3>
<p>You should now be able to issue Hive SQL <code>SELECT</code> queries and see the results returned from the underlying Iceberg table, for example:</p>
<pre><code class="language-sql">SELECT * from table_a;
</code></pre>
<h2 id="writing-with-sql">Writing with SQL<a class="headerlink" href="#writing-with-sql" title="Permanent link">&para;</a></h2>
<h3 id="configurations_1">Configurations<a class="headerlink" href="#configurations_1" title="Permanent link">&para;</a></h3>
<p>Here are the Hadoop configurations that one can adjust for the Hive writer:</p>
<table>
<thead>
<tr>
<th>Config key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>iceberg.mr.commit.table.thread.pool.size</td>
<td>10</td>
<td>the number of threads of a shared thread pool to execute parallel commits for output tables</td>
</tr>
<tr>
<td>iceberg.mr.commit.file.thread.pool.size</td>
<td>10</td>
<td>the number of threads of a shared thread pool to execute parallel commits for files in each output table</td>
</tr>
</tbody>
</table>
<h3 id="insert-into">INSERT INTO<a class="headerlink" href="#insert-into" title="Permanent link">&para;</a></h3>
<p>Hive supports the standard single-table <code>INSERT INTO</code> operation:</p>
<pre><code class="language-sql">INSERT INTO table_a VALUES ('a', 1);
INSERT INTO table_a SELECT ...;
</code></pre>
<p>Multi-table insert is also supported, but it will not be atomic and are committed one table at a time. Partial changes will be visible during the commit process and failures can leave partial changes committed. Changes within a single table will remain atomic.</p>
<p>Here is an example of inserting into multiple tables at once in Hive SQL:</p>
<pre><code class="language-sql">FROM customers
    INSERT INTO target1 SELECT customer_id, first_name
    INSERT INTO target2 SELECT last_name, customer_id;
</code></pre>
<h2 id="type-compatibility">Type compatibility<a class="headerlink" href="#type-compatibility" title="Permanent link">&para;</a></h2>
<p>Hive and Iceberg support different set of types. Iceberg can perform type conversion automatically, but not for all combinations,
so you may want to understand the type conversion in Iceberg in prior to design the types of columns in your tables.
You can enable auto-conversion through Hadoop configuration (not enabled by default):</p>
<table>
<thead>
<tr>
<th>Config key</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>iceberg.mr.schema.auto.conversion</td>
<td>false</td>
<td>if Hive should perform type auto-conversion</td>
</tr>
</tbody>
</table>
<h3 id="hive-type-to-iceberg-type">Hive type to Iceberg type<a class="headerlink" href="#hive-type-to-iceberg-type" title="Permanent link">&para;</a></h3>
<p>This type conversion table describes how Hive types are converted to the Iceberg types.
The conversion applies on both creating Iceberg table and writing to Iceberg table via Hive.</p>
<table>
<thead>
<tr>
<th>Hive</th>
<th>Iceberg</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean</td>
<td>boolean</td>
<td></td>
</tr>
<tr>
<td>short</td>
<td>integer</td>
<td>auto-conversion</td>
</tr>
<tr>
<td>byte</td>
<td>integer</td>
<td>auto-conversion</td>
</tr>
<tr>
<td>integer</td>
<td>integer</td>
<td></td>
</tr>
<tr>
<td>long</td>
<td>long</td>
<td></td>
</tr>
<tr>
<td>float</td>
<td>float</td>
<td></td>
</tr>
<tr>
<td>double</td>
<td>double</td>
<td></td>
</tr>
<tr>
<td>date</td>
<td>date</td>
<td></td>
</tr>
<tr>
<td>timestamp</td>
<td>timestamp without timezone</td>
<td></td>
</tr>
<tr>
<td>timestamplocaltz</td>
<td>timestamp with timezone</td>
<td>Hive 3 only</td>
</tr>
<tr>
<td>interval_year_month</td>
<td></td>
<td>not supported</td>
</tr>
<tr>
<td>interval_day_time</td>
<td></td>
<td>not supported</td>
</tr>
<tr>
<td>char</td>
<td>string</td>
<td>auto-conversion</td>
</tr>
<tr>
<td>varchar</td>
<td>string</td>
<td>auto-conversion</td>
</tr>
<tr>
<td>string</td>
<td>string</td>
<td></td>
</tr>
<tr>
<td>binary</td>
<td>binary</td>
<td></td>
</tr>
<tr>
<td>decimal</td>
<td>decimal</td>
<td></td>
</tr>
<tr>
<td>struct</td>
<td>struct</td>
<td></td>
</tr>
<tr>
<td>list</td>
<td>list</td>
<td></td>
</tr>
<tr>
<td>map</td>
<td>map</td>
<td></td>
</tr>
<tr>
<td>union</td>
<td></td>
<td>not supported</td>
</tr>
</tbody>
</table></div>
        
        
    </div>

    
      <footer class="col-md-12 text-center">
          
          
            <hr>
            <p>
            <small>Copyright 2018-2021 <a href='https://www.apache.org/'>The Apache Software Foundation</a><br />Apache Iceberg, Iceberg, Apache, the Apache feather logo, and the Apache Iceberg project logo are either registered<br />trademarks or trademarks of The Apache Software Foundation in the United States and other countries.</small><br>
            
            <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</small>
            </p>
          

          
          
      </footer>
    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="../js/bootstrap-3.0.3.min.js"></script>

    
    <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.0/build/highlight.min.js"></script>
        
    <script>hljs.initHighlightingOnLoad();</script>
    

    <script>var base_url = ".."</script>
    
    <script src="../js/base.js"></script>

    <div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    </body>

</html>
